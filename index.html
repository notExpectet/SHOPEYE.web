<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>ShopEye - Angebote</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts: Inter -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
  <!-- Externe CSS-Datei einbinden -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="main-header">
    <nav>
      <div class="container">
        <div class="search-container">
          <form class="search-form">
            <input type="text" placeholder="Angebote suchen..." class="search-input">
            <button type="submit" class="search-button">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </button>
          </form>
        </div>
      </div>
    </nav>
  </header>
  
  <main class="main-content">
    <div class="container">
      <h1 class="current-offer-title">Aktuelle Angebote</h1>
      
      <!-- Angebotskarten werden hier dynamisch eingefügt -->
      <div class="cards-grid" id="cards-grid">
        <!-- Firebase-Daten -->
      </div>
      
      <!-- Formular zum Hinzufügen eines neuen Angebots -->
      <form id="add-offer-form" class="offer-form">
        <h2>Neues Angebot hinzufügen</h2>
        <input type="text" id="item-name" placeholder="Artikelname" required>
        <input type="number" id="price" placeholder="Preis" required>
        <input type="number" id="amount" placeholder="Menge" required>
        <input type="text" id="seller" placeholder="Verkäufername" required>
        <input type="text" id="coordinates" placeholder="Koordinaten (z.B. 100,64,200)" required>
        <button type="submit">Angebot hinzufügen</button>
      </form>
    </div>
  </main>
  
  <!-- Firebase-Integration -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyCNvhdtrIfpUMX2a-uzi2l-a968gj77igY",
      authDomain: "shopeye-95c07.firebaseapp.com",
      databaseURL: "https://shopeye-95c07-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "shopeye-95c07",
      storageBucket: "shopeye-95c07.firebasestorage.app",
      messagingSenderId: "379955108962",
      appId: "1:379955108962:web:185dc36ce9aa427d08853b",
      measurementId: "G-3XP6GZQTJH"
    };
    
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    
    const cardsGrid = document.getElementById("cards-grid");
    
    function fetchOffers() {
      const offersRef = ref(database, 'offers/');
      onValue(offersRef, (snapshot) => {
        const offers = snapshot.val();
        cardsGrid.innerHTML = "";
        for (const offerId in offers) {
          const offer = offers[offerId];
          const card = document.createElement("article");
          card.className = "offer-card";
          card.innerHTML = `
            <div class="card-content">
              <h3 class="card-title">${offer.itemName}</h3>
              <p class="card-description">
                Menge: ${offer.amount}<br>
                Verkäufer: ${offer.seller}<br>
                Koordinaten: ${offer.coordinates}
              </p>
              <div class="card-footer">
                <span class="price">€${offer.price}</span>
                <button class="details-button">Details</button>
              </div>
            </div>
          `;
          cardsGrid.appendChild(card);
        }
      });
    }
    
    fetchOffers();
    
    const addOfferForm = document.getElementById("add-offer-form");
    addOfferForm.addEventListener("submit", (event) => {
      event.preventDefault();
      const itemName = document.getElementById("item-name").value;
      const price = parseFloat(document.getElementById("price").value);
      const amount = parseInt(document.getElementById("amount").value, 10);
      const seller = document.getElementById("seller").value;
      const coordinates = document.getElementById("coordinates").value;
      
      const offersRef = ref(database, 'offers/');
      const newOfferRef = push(offersRef);
      
      set(newOfferRef, {
        itemName,
        price,
        amount,
        seller,
        coordinates
      }).then(() => {
        addOfferForm.reset();
        alert("Angebot erfolgreich hinzugefügt!");
      }).catch((error) => {
        console.error("Fehler beim Hinzufügen des Angebots:", error);
      });
    });
  </script>
</body>
</html>
